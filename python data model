"""
Created on Mon Apr 25 18:47:28 2022

@author: aamir
"""

"""
import required libraries
"""

import pandas as pd
import seaborn as sns
import numpy as np
from sklearn.preprocessing import LabelEncoder
import matplotlib.pyplot as plt


"""
reading the files
"""

""" Exploration """
data= pd.read_csv(r"C:\Users\aamir\Desktop\diabetes_data_upload.csv")
data.head()

data.columns
data.head()
data.info()


sns.catplot(x="Gender",col = "class",data=data,kind="count")
sns.catplot(x="Obesity",col = "class",data=data,kind="count")
sns.catplot(x="Polyuria",col = "class",data=data,kind="count")
data.hist(by='class',column='Gender',color='green',bins=3)
plt.show()

data['class'].value_counts()
sns.countplot(x='class',data=data,palette='hls')
no_of_positive = len(data[data['class'] =="Positive"])
no_of_negative = len(data[data['class']== "Negative"])
ofPos = (no_of_positive * 100)/ (no_of_positive + no_of_negative)
ofNeg = (no_of_negative * 100)/ (no_of_positive + no_of_negative)
print("positive cases")
print(ofPos)
print("negative cases")    
print(ofNeg)



"""
train and test split and also changing categorial variable to numeric binary """

X = data.iloc[:,0:16]
y = data.loc[:,'class']



X = pd.DataFrame(X)
def Encoder(X1):
          columnsToEncode = list(X1.select_dtypes(include=['category','object']))
          le = LabelEncoder()
          for feature in columnsToEncode:
              try:
                  X1[feature] = le.fit_transform(X1[feature])
              except:
                  print('Error encoding '+feature)
          return X

columnsToEncode = list(X.select_dtypes(include=['category','object']))
X = Encoder(X)




X.head()
y.head()


label_encoder = LabelEncoder()
y = label_encoder.fit_transform(y)

from sklearn.model_selection import train_test_split
X_train,X_test,y_train,y_test = train_test_split(X,y,test_size=0.25,random_state=0)
from sklearn.linear_model import LogisticRegression
logreg = LogisticRegression()
logreg.fit(X_train,y_train)
y_pred = logreg.predict(X_test)

""" confusion matrix"""

plt.clf()
from sklearn import metrics
cf = metrics.confusion_matrix(y_test,y_pred)
import matplotlib.pyplot as plt
ax = plt.subplot()
sns.heatmap(cf,cmap="YlGnBu",annot=True,fmt='g',ax = ax)
plt.xlabel("Predict Laebel")
plt.ylabel("Actual Label")
plt.title('Diabetics Risk chart')


print("Accuracy:",metrics.accuracy_score(y_test, y_pred))
print("Precision:",metrics.precision_score(y_test, y_pred))
print("Recall:",metrics.recall_score(y_test, y_pred))
abc = pd.DataFrame(data)
